# プロンプトエンジニアリング

そもそも[プロンプト](#プロンプト)エンジニアリングとは何なのか

これは自然言語処理[(NLP)](#nlp)や機械学習の文脈で使われる用語で、

機械学習モデルやNLPモデルに対する入力テキストを設計し、調整するプロセスを指します。

プロンプトエンジニアリングが重要となってくる場面は特に大規模な言語モデルを使用するときです。

## 具体的にプロンプトエンジニアリングとは何なのか

プロンプトエンジニアリングは大規模な言語モデルを使用する際に重要だと先ほどお伝えしましたが、

では一体具体的には何なのか...。

以下がプロンプトエンジニアリングに含まれる要素です。

- [プロンプトの設計](#プロンプトの設計)
- [ハイパーパラメータの調整](#ハイパーパラメータの調整)

### プロンプトの設計

機械学習モデルに対して与えられる入力テキストやクエリを作成するプロセスのことで、目的はモデルが特定のタスクで望ましい結果を生成するのを支援するためです。

`タスクの理解`

当然のことですが、プロンプトを生成する側がそれによって何を生み出したいのか、どういったことを知りたいのかを十分に理解していない場合、それはモデルも同様です。

実行するタスクに対して、十分な理解をし、必要な情報は何か、どういった結果を期待するのかを明確に把握することが必須です。

<Details><Summary>Rubyでシンプルなサーバーを作成したい</Summary>

Rubyをインストール:
まず、Rubyをインストールしていない場合は、公式ウェブサイトから最新のバージョンをダウンロードしてインストールしてください。

ソケットを使ってサーバーを作成:
Rubyでは、ソケットを使用してシンプルなWebサーバーを作成できます。以下は、基本的な例です。

```ruby
require 'socket'

server = TCPServer.new('localhost', 8080)

puts 'Server is running on http://localhost:8080/'

loop do
  client = server.accept

  request = client.gets
  puts request

  response = "Hello, World!\n"

  client.puts "HTTP/1.1 200 OK"
  client.puts "Content-Type: text/plain"
  client.puts "Content-Length: #{response.length}"
  client.puts
  client.puts response

  client.close
end
```
このコードは、8080ポートでリクエストを受け付け、"Hello, World!"というテキストを応答として返します。ブラウザで http://localhost:8080/ にアクセスすると、ブラウザに "Hello, World!" が表示されます。

このコードは非常にシンプルな例であり、実際のWebアプリケーション用には改良が必要です。Webフレームワーク（例: Ruby on Rails、Sinatra）を使用することを検討することをお勧めします。それらのフレームワークはルーティング、ビュー、モデルなどの機能を提供し、より効率的にWebアプリケーションを構築できます。

</Details><br>

<Details><Summary>Sinatraを用いて、用意したIndex.htmlファイルをWebページとして表示させたい
その際にAPIのエンドポイントとしてgetImageを用意してほしい、それ以外はシンプルでいいです</Summary>

Sinatraのインストール:
まず、RubyとBundlerがインストールされていることを確認してください。次に、Sinatraをインストールします。

```bash
gem install sinatra
```
Sinatraアプリケーションの作成:
以下のようなディレクトリ構造で、Sinatraアプリケーションを作成します。

```text
my_sinatra_app/
├── app.rb
├── public/
│      └── index.html
```
Sinatraアプリケーションのコード（app.rb）を以下のように作成します。

```rb
require 'sinatra'

# ルートエンドポイント - index.htmlを提供
get '/' do
  send_file File.join(settings.public_folder, 'index.html')
end

# getImageエンドポイント - 画像を提供するAPI
get '/getImage' do
  # 画像ファイルのパスを指定
  image_path = 'path/to/your/image.jpg'
  send_file image_path, type: 'image/jpeg'
end
```

Sinatraアプリケーションを実行:

```bash
ruby app.rb
```

これで、Sinatraアプリケーションがローカルで実行され、Webブラウザで http://localhost:4567/ にアクセスすると index.html が表示され、http://localhost:4567/getImage にアクセスすると指定した画像が提供されます。

デプロイする際には、Sinatraアプリケーションを適切なWebサーバー（たとえば、Heroku、AWS、または自分のサーバー）にデプロイし、公開すれば、他のユーザーがアクセスできるようになります。デプロイの方法は、選択したホスティングプラットフォームに依存します。

</Details><br>

`クリエイティブなプロンプト`

プロンプトはキーワードや単語をひたすら挙げるのではなく、具体的に人と会話するように、指示や質問を含む文言で作成します。

人間と同じで、単語をひたすら与えられても、話し手の意図を理解することは困難で、適切な返答が返ってくる保証がありません。

`ターゲットデータの統合`

ターゲットデータやドメイン固有の知識を統合することが役立つ。

特定の分野や業界に関する専門的な用語やコンセプトを取り入れ、モデルがタスクに関連するコンテキストを理解できるようにする

`フィードバックループ`

モデルの出力を確認して、プロンプトの調整をする必要があるかを評価する。

フィードバックし、より我々の意図する内容を出力してくれるように調整していくことで、モデルの性能向上を寄与する

`ベストプラクティスの活用`

過去の成功事例などを参考にする

他の研究者や実務家の経験から学び、効果的なプロンプトを設計するための洞察を得る

### [ハイパーパラメータ](#ハイパーパラメータ)の調整

モデルの[学習率](#学習率)や[エポック数](#エポック数)、[バッチサイズ](#バッチサイズ)などを調整して、モデルの性能を最適する

`ハイパーパラメータの選択`

初めに、モデルのハイパーパラメータを選択します。

これには学習率、エポック数、バッチサイズ、隠れ層のユニット数、活性化関数、ドロップアウト率、正則化の強度などが含まれます。

`グリッドサーチまたはランダムサーチ`

ハイパーパラメータの調整には、グリッドサーチやランダムサーチなどのアプローチがあります。

グリッドサーチでは、事前に定義された値の組み合わせを試すことになり、ランダムサーチではランダムに選択された値の組み合わせを試行します。

これらの方法を使用して、広範囲のハイパーパラメータの値を評価し、最適な組み合わせを見つけます。

`クロスバリデーション`

モデルの性能を評価するために、クロスバリデーションを使用します。

データセットを複数のフォールド（分割）に分け、各フォールドをテストセットとして使用し、他のフォールドでモデルをトレーニングします。

これにより、過学習を避けつつハイパーパラメータの性能を評価できます。

`パフォーマンス指標の選択`

ハイパーパラメータの調整では、モデルの性能を評価するための適切なパフォーマンス指標を選択します。

一般的な指標には、精度、F1スコア、平均二乗誤差（MSE）、対数尤度などが含まれます。

`ハイパーパラメータの反復的な調整`

評価結果に基づいて、ハイパーパラメータを調整します。

最適な組み合わせを見つけるために、何度も試行し、ハイパーパラメータの値を微調整します。

`自動ハイパーパラメータ最適化`

自動ハイパーパラメータ最適化ツールやフレームワークを使用することもできます。これらのツールは、ハイパーパラメータの探索プロセスを自動化し、効率的な最適化を支援します。

---

#### プロンプト

プロンプトとは、コンピューターやプログラムの対話型インターフェイスで、

ユーザーやシステムとの対話を始めるための指示や要求を示すテキストなどのこと。

> コマンド'プロンプト'はCLIでユーザーにコマンドの入力を支持するためのテキスト、windowsの「C:>」や、Linuxの「＄」これらの記号はコマンドラインプロンプトの一部

#### NLP

Natural Language Processing の略。

人間が日常的に使用している自然言語をコンピュータに処理・解析させる技術のこと。

#### ハイパーパラメータ

ハイパーパラメータ（Hyperparameters）は、機械学習アルゴリズムやモデルの設定を制御し、調整するためのパラメータ

#### 学習率

学習率は、モデルの更新ステップごとに重みやパラメータをどれだけ調整するかを制御するパラメータ

高い学習率は学習を速めますが、収束しづらくなり、低い学習率は収束が遅くなります。適切な学習率の選択は重要

[参考 : 学習率について](https://www.tryeting.jp/column/6842/)

#### エポック数

エポック数は、データセット全体を何度も学習することを指します。モデルがデータに適応するために何度学習プロセスを繰り返すかを制御

[参考 : エポック数について](https://www.st-hakky-blog.com/entry/2017/01/17/165137)

#### バッチサイズ

全学習データをグループに分ける際の1グループのサイズのこと

6000データを600*10に分けた際に、バッチサイズは600となる

[参考 : バッチサイズについて](https://www.tryeting.jp/column/6047/)